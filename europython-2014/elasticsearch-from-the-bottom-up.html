<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://use.fontawesome.com/2231f865fc.js"></script>
    <link rel="shortcut icon" href="https://pyvideo.org/theme/images/favicon.png">
    <meta name="google-site-verification" content="cHuieLjiIIDAHKKXSPPDsnbLEz9QgVNTi23qy_mOzDU" />

    <title>PyVideo.org &middot; Elasticsearch from the bottom up</title>

    <link href="https://pyvideo.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyVideo.org Full Atom Feed" />
    <link href="https://pyvideo.org/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyVideo.org Full RSS Feed" />
    <link href="https://pyvideo.org/feeds/event_europython-2014.atom.xml" type="application/atom+xml" rel="alternate" title="PyVideo.org Event Atom Feed" />
    <link href="https://pyvideo.org/feeds/event_europython-2014.rss.xml" type="application/rss+xml" rel="alternate" title="PyVideo.org Event RSS Feed" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw=="
          crossorigin="anonymous">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="/theme/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/theme/css/base.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


  <meta property="og:site_name" content="PyVideo.org" />
  <meta property="og:title" content="Elasticsearch from the bottom up" />
  <meta property="og:type" content="video" />
  <meta property="og:url" content="https://pyvideo.org/europython-2014/elasticsearch-from-the-bottom-up.html" />
    <meta property="og:image" content="https://i.ytimg.com/vi/PpX7J-G2PEo/hqdefault.jpg" />
    <meta property="og:image:secure_url" content="https://i.ytimg.com/vi/PpX7J-G2PEo/hqdefault.jpg" />
    <meta property="og:image:type" content="image/jpeg" />


</head>

<body>
<a class="github" href="https://github.com/pyvideo/pyvideo/wiki/How-to-Contribute-Media">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 2;" src="/images/contribute_to_me_right_red_aa0000.png" alt="Contribute Media" />
</a>
  <div class="header notice clearfix">
    A thank you to everyone who makes this possible:
    <a href="/pages/thank-you-contributors.html">Read More</a>
  </div>
  <header id="banner" class="header clearfix">
    <nav class="header__nav"><div class="container">
      <ul class="nav">
        <li role="presentation">
          <a href="https://pyvideo.org/index.html"><i class="fa fa-fw fa-home"></i> <span>Start</span></a>
        </li>

        <li role="presentation" class="active">
          <a href="https://pyvideo.org/events.html"><i class="fa fa-fw fa-list-ul"></i> <span>Events</span></a>
        </li>

        <li role="presentation">
          <a href="https://pyvideo.org/tags.html"><i class="fa fa-fw fa-tags"></i> <span>Tags</span></a>
        </li>

        <li role="presentation">
          <a href="https://pyvideo.org/speakers.html"><i class="fa fa-fw fa-users"></i> <span>Speakers</span></a>
        </li>

          <li role="presentation"
>
            <a href="https://pyvideo.org/pages/about.html"><i class="fa fa-fw fa-info"></i> <span>About</span></a>
          </li>
          <li role="presentation"
style="display: none;">
            <a href="https://pyvideo.org/pages/thank-you-contributors.html"><i class="fa fa-fw fa-info"></i> <span>Thank You</span></a>
          </li>
          <li role="presentation"
style="display: none;">
            <a href="https://pyvideo.org/pages/thanks-will-and-sheila.html"><i class="fa fa-fw fa-info"></i> <span></span></a>
          </li>
      </ul>
    </div></nav>
    <div class="container">
      <h3 class="text-muted header__title">
      <a href="https://pyvideo.org/"><img src="/theme/images/logo.png" alt="" style="height:50px"> <span><i>Py</i>Video</span> <strong></strong></a>
      </h3>
      <div class="header__searchbox">
        <form method="GET" action="/search.html">
          <input name="q" type="search" placeholder="Search...">
        </form>
      </div>
    </div>
  </header>
  <div class="container">

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://pyvideo.org/europython-2014/elasticsearch-from-the-bottom-up.html" rel="bookmark"
         title="Permalink to Elasticsearch from the bottom up">Elasticsearch from the bottom up
      </a>
    </h2>
 
  </header>

  <footer class="post-info">
    <time class="published" datetime="2014-07-24T00:00:00+00:00">
      <i class="fa fa-calendar"></i> Thu 24 July 2014
    </time>
    <address class="vcard author">
      By
        <a class="url fn" href="https://pyvideo.org/speaker/alex-brasetvik.html">Alex Brasetvik</a>
    </address>
  </footer><!-- /.post-info -->

  <div class="entry-content">
<ul class="nav nav-tabs" role="tablist">
    <li class="active" role="presentation"><a href="#youtube" aria-controls="youtube" role="tab" data-toggle="tab">
        <i class="fa fa-fw fa-youtube"></i> YouTube
    </a></li>
</ul>

<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="youtube">
        <div class="embed-responsive embed-responsive-16by9 videocontainer">
            <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/PpX7J-G2PEo" title="Video for " frameborder="0" allowfullscreen></iframe>
        </div>
    </div>
</div>    <h3>Summary</h3><p>This talk will teach you about Elasticsearch and Lucene's architecture.</p>
<p>The key data structure in search is the powerful inverted index, which
is actually simple to understand. We start there, then ascend through
abstraction layers to get an overview of how a distributed search
cluster processes searches and changes.</p>
<h3>Description</h3><div class="section" id="who-i-am-and-motivation">
<h4>Who I am and motivation</h4>
<p>I work with hosted Elasticsearch and have interacted with lots of
developers. We see what many struggle with.</p>
<p>Some relevant theory helps a lot. What follows has already lead to many
&quot;Aha!&quot;-moments and developers piecing things together herself.</p>
</div>
<div class="section" id="the-inverted-index">
<h4>The inverted index</h4>
<p>The most important index structure is actually very simple. It is
essentially a sorted dictionary of terms, with a list of postings per
term.</p>
<p>We show three simple sample documents and the resulting inverted index.</p>
</div>
<div class="section" id="the-index-term">
<h4>The index term</h4>
<p>The index term is the &quot;unit of search&quot;, and the terms we make decide how
we can search.</p>
<p>With the inverted index and its sorted dictionary, we can quickly search
for terms given their prefix.</p>
</div>
<div class="section" id="importance-of-text-analysis">
<h4>Importance of text analysis</h4>
<p>Thus, we need to transform our search problems into string prefix
problems.</p>
<p>This is done with text analysis, which is the process of making of index
terms. It is highly important when implementing search.</p>
</div>
<div class="section" id="building-indexes">
<h4>Building indexes</h4>
<p>The way indexes are built must balance how compact an index is, how
easily we can search in it, how fast we can index documents - and the
time it takes for changes to be visible.</p>
<p>Lucene, and thus Elasticsearch, builds them in segments.</p>
</div>
<div class="section" id="index-segments">
<h4>Index segments</h4>
<p>A Lucene index consists of index segments, i.e. immutable mini-indexes.</p>
<p>A search on an index is done by doing the search on all segments and
merging the results.</p>
<p>Segments are immutable:</p>
<p>This enables important compression techniques. Deletes are not
immediate, just a marker. Segments are occasionally merged to larger
segments. Then documents are finally deleted. New segments are made by
buffering changes in memory, and written when flushing happens. Flushes
are largely caused by refreshing every second, due to real time needs.</p>
</div>
<div class="section" id="caches">
<h4>Caches</h4>
<p>Caches like filter- and field caches are managed per segment. They are
essential for performance.</p>
<p>Immutable segments make for simple reasoning about caches. New segments
only cause partial cache invalidations.</p>
</div>
<div class="section" id="elasticsearch-indexes">
<h4>Elasticsearch indexes</h4>
<p>Much like a Lucene index is made up of many segments, an Elasticsearch
index is made up of many Lucene indexes.</p>
<p>Two Elasticsearch indexes with 1 shard is essentially the same as one
Elasticsearch index with 2 shards.</p>
<p>Search all shards and merge. Much like segments, but this time possibly
across machines.</p>
<p>Shard / Index routing enables various partitioning strategies. Simpler
than it sounds, so one important example:</p>
<p>Essential for time based data, like logs: can efficiently skip searching
entire indexes - and roll out old data by deleting the entire index.</p>
</div>
<div class="section" id="common-pitfalls">
<h4>Common pitfalls</h4>
<p>We must design our indexing for how we search - not the searches for how
things are indexed. Be careful with wildcards and regexes.</p>
<p>Since segments are immutable, deleting documents is expensive while
deleting an entire index is cheap.</p>
<p>Updating documents is essentially a delete and re-index. Heavy updating
might cause problems.</p>
<p>Have enough memory and then some. Elasticsearch is very reliant on its
caches.</p>
</div>
<div class="section" id="summary">
<h4>Summary</h4>
<p>We've seen how index structures are used, and why proper text processing
is essential for performant searches.</p>
<p>Also, you now know what index segments are, and how they affect both
indexing and searching strategies.</p>
</div>
<div class="section" id="questions">
<h4>Questions</h4>
</div>

  </div><!-- /.entry-content -->

<div class="details-content">
  <h3>Details</h3>
  <ul>
      <li>
        Event:
        <a href="https://pyvideo.org/events/europython-2014.html">EuroPython 2014</a>
      </li>
        <li>Language: English</li>
        <li>
            Media URL: <a href="https://www.youtube.com/watch?v=PpX7J-G2PEo" rel="external">YouTube</a>        </li>

  </ul>
</div>
    <a href="https://github.com/pyvideo/data/blob/master/europython-2014/videos/elasticsearch-from-the-bottom-up.json">
      <i class="fa fa-pencil-square-o"></i> Improve this page
    </a>

</section>

    <footer class="footer">
      <p>
        &copy;
        <a href="https://github.com/pyvideo/pyvideo/blob/master/LICENSE">PyVideo.org</a> |
        <a href="https://github.com/pyvideo/data/blob/master/LICENSE">pyvideo/data</a>
      </p>
    </footer>

      <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
      <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
      <script src="/theme/js/ie10-viewport-bug-workaround.js"></script>
      <script src="/theme/js/thumb.js"></script>
      <script src="/theme/js/language.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72949800-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </div>
</body>
</html>