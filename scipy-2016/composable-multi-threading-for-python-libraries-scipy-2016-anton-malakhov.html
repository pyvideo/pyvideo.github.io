<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://use.fontawesome.com/2231f865fc.js"></script>
    <link rel="shortcut icon" href="https://pyvideo.org/theme/images/favicon.png">
    <meta name="google-site-verification" content="cHuieLjiIIDAHKKXSPPDsnbLEz9QgVNTi23qy_mOzDU" />

    <title>PyVideo.org &middot; Composable Multi Threading for Python Libraries</title>

    <link href="https://pyvideo.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyVideo.org Full Atom Feed" />
    <link href="https://pyvideo.org/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyVideo.org Full RSS Feed" />
    <link href="https://pyvideo.org/feeds/event_scipy-2016.atom.xml" type="application/atom+xml" rel="alternate" title="PyVideo.org Event Atom Feed" />
    <link href="https://pyvideo.org/feeds/event_scipy-2016.rss.xml" type="application/rss+xml" rel="alternate" title="PyVideo.org Event RSS Feed" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw=="
          crossorigin="anonymous">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="/theme/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/theme/css/base.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


  <meta property="og:site_name" content="PyVideo.org" />
  <meta property="og:title" content="Composable Multi Threading for Python Libraries" />
  <meta property="og:type" content="video" />
  <meta property="og:url" content="https://pyvideo.org/scipy-2016/composable-multi-threading-for-python-libraries-scipy-2016-anton-malakhov.html" />
    <meta property="og:image" content="https://i.ytimg.com/vi/kfQcWez2URE/maxresdefault.jpg" />
    <meta property="og:image:secure_url" content="https://i.ytimg.com/vi/kfQcWez2URE/maxresdefault.jpg" />
    <meta property="og:image:type" content="image/jpeg" />


    <meta name="tags" content="SciPy 2016" />
</head>

<body>
<a class="github" href="https://github.com/pyvideo/pyvideo/wiki/How-to-Contribute-Media">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 2;" src="/images/contribute_to_me_right_red_aa0000.png" alt="Contribute Media" />
</a>
  <div class="header notice clearfix">
    A thank you to everyone who makes this possible:
    <a href="/pages/thank-you-contributors.html">Read More</a>
  </div>
  <header id="banner" class="header clearfix">
    <nav class="header__nav"><div class="container">
      <ul class="nav">
        <li role="presentation">
          <a href="https://pyvideo.org/index.html"><i class="fa fa-fw fa-home"></i> <span>Start</span></a>
        </li>

        <li role="presentation" class="active">
          <a href="https://pyvideo.org/events.html"><i class="fa fa-fw fa-list-ul"></i> <span>Events</span></a>
        </li>

        <li role="presentation">
          <a href="https://pyvideo.org/tags.html"><i class="fa fa-fw fa-tags"></i> <span>Tags</span></a>
        </li>

        <li role="presentation">
          <a href="https://pyvideo.org/speakers.html"><i class="fa fa-fw fa-users"></i> <span>Speakers</span></a>
        </li>

          <li role="presentation"
>
            <a href="https://pyvideo.org/pages/about.html"><i class="fa fa-fw fa-info"></i> <span>About</span></a>
          </li>
          <li role="presentation"
style="display: none;">
            <a href="https://pyvideo.org/pages/thank-you-contributors.html"><i class="fa fa-fw fa-info"></i> <span>Thank You</span></a>
          </li>
          <li role="presentation"
style="display: none;">
            <a href="https://pyvideo.org/pages/thanks-will-and-sheila.html"><i class="fa fa-fw fa-info"></i> <span></span></a>
          </li>
      </ul>
    </div></nav>
    <div class="container">
      <h3 class="text-muted header__title">
      <a href="https://pyvideo.org/"><img src="/theme/images/logo.png" alt="" style="height:50px"> <span><i>Py</i>Video</span> <strong></strong></a>
      </h3>
      <div class="header__searchbox">
        <form method="GET" action="/search.html">
          <input name="q" type="search" placeholder="Search...">
        </form>
      </div>
    </div>
  </header>
  <div class="container">

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://pyvideo.org/scipy-2016/composable-multi-threading-for-python-libraries-scipy-2016-anton-malakhov.html" rel="bookmark"
         title="Permalink to Composable Multi Threading for Python Libraries">Composable Multi Threading for Python Libraries
      </a>
    </h2>
 
  </header>

  <footer class="post-info">
    <time class="published" datetime="2016-07-14T00:00:00+00:00">
      <i class="fa fa-calendar"></i> Thu 14 July 2016
    </time>
    <address class="vcard author">
      By
        <a class="url fn" href="https://pyvideo.org/speaker/anton-malakhov.html">Anton Malakhov</a>
    </address>
  </footer><!-- /.post-info -->

  <div class="entry-content">
<ul class="nav nav-tabs" role="tablist">
    <li class="active" role="presentation"><a href="#youtube" aria-controls="youtube" role="tab" data-toggle="tab">
        <i class="fa fa-fw fa-youtube"></i> YouTube
    </a></li>
</ul>

<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="youtube">
        <div class="embed-responsive embed-responsive-16by9 videocontainer">
            <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/kfQcWez2URE" title="Video for " frameborder="0" allowfullscreen></iframe>
        </div>
    </div>
</div>    <h3>Description</h3><p>Multi-processing parallelism in Python might be unacceptable due to cache-inefficiency and memory overhead. On the other hand, multi-threaded parallelism with Python suffers from the GIL but when it comes to numeric computations, most of the time is spent in native codes where the GIL can easily be released. This is why modules such as Dask and Numba use multi-threading to greatly speed up the computations. But being used together in a nested way, e.g. when a Dask task calls Numba's threaded ufunc, it leads to the situation where there are more active software threads than available hardware resources. This situation is called over-subscription and it leads to inefficient execution due to frequent context switches, thread migration, broken cache-efficiency, and finally to a load imbalance when some threads finished their work but others are stuck along with the overall progress.</p>
<p>Another example is Numpy/Scipy when they are accelerated using Intel Math Kernels Library (MKL) like the ones shipped as part of Intel Distribution for Python. MKL is usually threaded using OpenMP which is known for not easily co-existing even with itself. In particular, OpenMP threads keep spin-waiting after the work is done -- which is usually necessary to reduce work distribution overhead for the next possible parallel region. But it plays badly with another thread pool because while OpenMP worker threads keep consuming CPU time in spin-waiting, the other parallel work like Numba's ufunc cannot start until OpenMP threads stop spinning or are preempted by the OS.</p>
<p>And the worst case is also connected to usage of OpenMP when a program starts multiple parallel tasks and each of these tasks ends up executing an OpenMP parallel region. This is quadratic over-subscription which ruins multi-threaded performance.</p>
<p>Our approach to solve these co-existence problems is to share one thread pool among all the necessary modules and native libraries so that one task scheduler will take care of this composability issue. Intel Threading Building Blocks (TBB) library works as such a task scheduler in our solution. TBB is a wide-spread and recognized C++ library for enabling multi-core parallelism. It was designed for composability, nested parallelism support, and avoidance of over-subscription from its early days. Thus we implemented a Python module which integrates TBB with Python, it is already available as part of Intel Distribution for Python and on Intel channel for conda users. I will show how to enable it for Numpy/Scipy, Dask, Numba, Joblib, and other threaded modules and demonstrate the performance benefits it brings.</p>

  </div><!-- /.entry-content -->

<div class="details-content">
  <h3>Details</h3>
  <ul>
      <li>
        Event:
        <a href="https://pyvideo.org/events/scipy-2016.html">SciPy 2016</a>
      </li>
        <li>Language: English</li>
        <li>
            Media URL: <a href="https://www.youtube.com/watch?v=kfQcWez2URE" rel="external">YouTube</a>        </li>
        <li>
          Tags:
<a href="https://pyvideo.org/tag/scipy-2016/">SciPy 2016</a>        </li>

  </ul>
</div>
    <a href="https://github.com/pyvideo/data/blob/master/scipy-2016/videos/composable-multi-threading-for-python-libraries-scipy-2016-anton-malakhov.json">
      <i class="fa fa-pencil-square-o"></i> Improve this page
    </a>

</section>

    <footer class="footer">
      <p>
        &copy;
        <a href="https://github.com/pyvideo/pyvideo/blob/master/LICENSE">PyVideo.org</a> |
        <a href="https://github.com/pyvideo/data/blob/master/LICENSE">pyvideo/data</a>
      </p>
    </footer>

      <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
      <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
      <script src="/theme/js/ie10-viewport-bug-workaround.js"></script>
      <script src="/theme/js/thumb.js"></script>
      <script src="/theme/js/language.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72949800-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </div>
</body>
</html>