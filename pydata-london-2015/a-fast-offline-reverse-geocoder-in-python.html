<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://use.fontawesome.com/2231f865fc.js"></script>
    <link rel="shortcut icon" href="https://pyvideo.org/theme/images/favicon.png">
    <meta name="google-site-verification" content="cHuieLjiIIDAHKKXSPPDsnbLEz9QgVNTi23qy_mOzDU" />

    <title>PyVideo.org &middot; A Fast, Offline Reverse Geocoder in Python</title>

    <link href="https://pyvideo.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="PyVideo.org Full Atom Feed" />
    <link href="https://pyvideo.org/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="PyVideo.org Full RSS Feed" />
    <link href="https://pyvideo.org/feeds/event_pydata-london-2015.atom.xml" type="application/atom+xml" rel="alternate" title="PyVideo.org Event Atom Feed" />
    <link href="https://pyvideo.org/feeds/event_pydata-london-2015.rss.xml" type="application/rss+xml" rel="alternate" title="PyVideo.org Event RSS Feed" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw=="
          crossorigin="anonymous">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="/theme/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/theme/css/base.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


  <meta property="og:site_name" content="PyVideo.org" />
  <meta property="og:title" content="A Fast, Offline Reverse Geocoder in Python" />
  <meta property="og:type" content="video" />
  <meta property="og:url" content="https://pyvideo.org/pydata-london-2015/a-fast-offline-reverse-geocoder-in-python.html" />
    <meta property="og:image" content="https://i.ytimg.com/vi/8TR3RxJXjr0/hqdefault.jpg" />
    <meta property="og:image:secure_url" content="https://i.ytimg.com/vi/8TR3RxJXjr0/hqdefault.jpg" />
    <meta property="og:image:type" content="image/jpeg" />


</head>

<body>
<a class="github" href="https://github.com/pyvideo/pyvideo/wiki/How-to-Contribute-Media">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 2;" src="/images/contribute_to_me_right_red_aa0000.png" alt="Contribute Media" />
</a>
  <div class="header notice clearfix">
    A thank you to everyone who makes this possible:
    <a href="/pages/thank-you-contributors.html">Read More</a>
  </div>
  <header id="banner" class="header clearfix">
    <nav class="header__nav"><div class="container">
      <ul class="nav">
        <li role="presentation">
          <a href="https://pyvideo.org/index.html"><i class="fa fa-fw fa-home"></i> <span>Start</span></a>
        </li>

        <li role="presentation" class="active">
          <a href="https://pyvideo.org/events.html"><i class="fa fa-fw fa-list-ul"></i> <span>Events</span></a>
        </li>

        <li role="presentation">
          <a href="https://pyvideo.org/tags.html"><i class="fa fa-fw fa-tags"></i> <span>Tags</span></a>
        </li>

        <li role="presentation">
          <a href="https://pyvideo.org/speakers.html"><i class="fa fa-fw fa-users"></i> <span>Speakers</span></a>
        </li>

          <li role="presentation"
>
            <a href="https://pyvideo.org/pages/about.html"><i class="fa fa-fw fa-info"></i> <span>About</span></a>
          </li>
          <li role="presentation"
style="display: none;">
            <a href="https://pyvideo.org/pages/thank-you-contributors.html"><i class="fa fa-fw fa-info"></i> <span>Thank You</span></a>
          </li>
          <li role="presentation"
style="display: none;">
            <a href="https://pyvideo.org/pages/thanks-will-and-sheila.html"><i class="fa fa-fw fa-info"></i> <span></span></a>
          </li>
      </ul>
    </div></nav>
    <div class="container">
      <h3 class="text-muted header__title">
      <a href="https://pyvideo.org/"><img src="/theme/images/logo.png" alt="" style="height:50px"> <span><i>Py</i>Video</span> <strong></strong></a>
      </h3>
      <div class="header__searchbox">
        <form method="GET" action="/search.html">
          <input name="q" type="search" placeholder="Search...">
        </form>
      </div>
    </div>
  </header>
  <div class="container">

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://pyvideo.org/pydata-london-2015/a-fast-offline-reverse-geocoder-in-python.html" rel="bookmark"
         title="Permalink to A Fast, Offline Reverse Geocoder in Python">A Fast, Offline Reverse Geocoder in Python
      </a>
    </h2>
 
  </header>

  <footer class="post-info">
    <time class="published" datetime="2015-06-21T00:00:00+00:00">
      <i class="fa fa-calendar"></i> Sun 21 June 2015
    </time>
    <address class="vcard author">
      By
        <a class="url fn" href="https://pyvideo.org/speaker/ajay-thampi.html">Ajay Thampi</a>
    </address>
  </footer><!-- /.post-info -->

  <div class="entry-content">
<ul class="nav nav-tabs" role="tablist">
    <li class="active" role="presentation"><a href="#youtube" aria-controls="youtube" role="tab" data-toggle="tab">
        <i class="fa fa-fw fa-youtube"></i> YouTube
    </a></li>
</ul>

<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="youtube">
        <div class="embed-responsive embed-responsive-16by9 videocontainer">
            <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/8TR3RxJXjr0" title="Video for " frameborder="0" allowfullscreen></iframe>
        </div>
    </div>
</div>    <h3>Summary</h3><p>A fast, offline reverse geocoder in Python. This implementation uses
a parallelised K-D tree and the details of this implementation will
be presented. The key feature is speed; 10 million coordinates can be
geocoded in less than 30 seconds. The library is released under the
LGPL license and is available at
<a class="reference external" href="https://github.com/thampiman/reverse-geocoder">https://github.com/thampiman/reverse-geocoder</a>.</p>
<h3>Description</h3><div class="section" id="introduction">
<h4>Introduction</h4>
<p>Reverse geocoding using online web services such as Google Maps is
incredibly slow and is also restrictive in terms of the number of
requests that can be made per day. Offline reverse geocoders have been
built for PostGIS databases and also Python but are either complicated
or slow. In this talk, I will be presenting a fast, offline reverse
geocoder in Python. The basic outline of the talk is presented below.</p>
</div>
<div class="section" id="the-library">
<h4>The Library</h4>
<p>The library improves on an existing one built by Richard Penman in the
following ways:</p>
<ol class="arabic simple">
<li>It supports Python 2 and 3.</li>
<li>It geocodes a lot more location information. Besides the place name,
city and country, the library returns the administrative regions (1 &amp;
2) and the nearest latitude and longitude.</li>
<li>But the key enhancement is performance. The library extends the K-D
tree class in the scipy package and implements a parallelised version
of it.</li>
</ol>
<p>This reverse geocoder is released under the LGPL license and is
available <a class="reference external" href="https://github.com/thampiman/reverse-geocoder">here</a>.</p>
</div>
<div class="section" id="implementation">
<h4>Implementation</h4>
<p>The first time the library is called, information on places with a
population greater than 1000 is downloaded from the
<a class="reference external" href="http://download.geonames.org/export/dump/">Geonames</a> database, and
it is stored locally. The GPS coordinates of these places are populated
in a K-D tree and the nearest neighbour (NN) algorithm is then used to
find the place closest to the input GPS coordinate. The scipy package
provides a <a class="reference external" href="http://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.spatial.KDTree.html%20%22cKDTree%22">K-D tree
class</a>
and this is extended to implement a multi-process version. In this talk,
I will be presenting details of this implementation. A basic background
in Python, numpy, multi-processing and shared memory is assumed. The K-D
tree class in the scipy package supports only the Minkowski p-norm
distance for the NN algorithm. Although this has not been released
publicly, I will also be presenting a version of the library using the
haversine formula for much more accurate geocoding.</p>
</div>
<div class="section" id="performance-study">
<h4>Performance Study</h4>
<p>The library supports two modes:</p>
<ol class="arabic simple">
<li>Single-process mode (Mode 1)</li>
<li>Multi-process mode (Mode 2): The default mode</li>
</ol>
<p>A performance comparison of the two modes on a quad-core Macbook Pro is
shown below. <img alt="Performance Comparison" src="https://raw.githubusercontent.com/thampiman/reverse-%20geocoder/master/performance.png" /></p>
<p>Mode 2 runs 2x faster especially for large inputs, i.e. 10M coordinates.</p>
</div>
<div class="section" id="applications">
<h4>Applications</h4>
<p>In this part of the talk, I will discuss how the library is being used
at <a class="reference external" href="http://opensignal.com/">OpenSignal</a>, where I work as a data
scientist. The main purpose for building the library was to be able to
geocode terabytes of data (approx. 500M coordinates). Speed was
therefore crucial. I will discuss methods on geocoding at this scale in
real-time and also offline. I will also talk about how this open-source
library is being used by the community.</p>
</div>
<div class="section" id="contributions-by-the-community">
<h4>Contributions by the Community</h4>
<p>Since its release on Github on 27-Mar-2015, the open-source community
has also been instrumental in testing, fixing bugs and implementing
additional features. In this part of the talk, I will given an overview
of the following two major changes made by other developers:</p>
<ol class="arabic simple">
<li>Python 3 support, and</li>
<li><a class="reference external" href="https://github.com/thampiman/reverse-geocoder/tree/master/c++">C++
wrapper</a>
for the Python library.</li>
</ol>
</div>

  </div><!-- /.entry-content -->

<div class="details-content">
  <h3>Details</h3>
  <ul>
      <li>
        Event:
        <a href="https://pyvideo.org/events/pydata-london-2015.html">PyData London 2015</a>
      </li>
        <li>Language: English</li>
        <li>
            Media URL: <a href="https://www.youtube.com/watch?v=8TR3RxJXjr0" rel="external">YouTube</a>        </li>

  </ul>
</div>
    <a href="https://github.com/pyvideo/data/blob/master/pydata-london-2015/videos/ajay-thampi-a-fast-offline-reverse-geocoder-in-python.json">
      <i class="fa fa-pencil-square-o"></i> Improve this page
    </a>

</section>

    <footer class="footer">
      <p>
        &copy;
        <a href="https://github.com/pyvideo/pyvideo/blob/master/LICENSE">PyVideo.org</a> |
        <a href="https://github.com/pyvideo/data/blob/master/LICENSE">pyvideo/data</a>
      </p>
    </footer>

      <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
      <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
      <script src="/theme/js/ie10-viewport-bug-workaround.js"></script>
      <script src="/theme/js/thumb.js"></script>
      <script src="/theme/js/language.js"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-72949800-2']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
  </div>
</body>
</html>